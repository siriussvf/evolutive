{% extends "base.html" %}

{% block content %}
<div class="min-h-screen py-10 px-4 md:px-0">
    <div class="max-w-4xl mx-auto space-y-8">

        <div class="flex items-center justify-between mb-10">
            <div>
                <h1 class="text-4xl font-bold text-white tracking-tight">Personalizaci√≥n</h1>
                <p class="text-gray-400 mt-2">Configura c√≥mo evoluciona iE contigo.</p>
            </div>
            <a href="/chat"
                class="px-6 py-2 bg-white/5 border border-white/10 rounded-full text-sm text-gray-300 hover:bg-white/10 transition flex items-center gap-2">
                <span>‚Üê</span> Volver al Chat
            </a>
        </div>

        <form action="/settings/save" method="POST" class="space-y-8">

            <!-- Identity Section -->
            <section class="glass-panel p-8 rounded-[2rem] border border-white/5 space-y-6">
                <h2 class="text-xl font-bold text-white flex items-center gap-3">
                    <span class="text-2xl">üÜî</span> Identidad y Contexto
                </h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-400 mb-2 ml-1">¬øC√≥mo te gustar√≠a que iE te
                            llamara?</label>
                        <input type="text" name="nickname" value="{{ user.nickname or '' }}"
                            placeholder="Tu apodo o nombre preferido"
                            class="w-full bg-black/20 border border-white/5 rounded-2xl px-5 py-4 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500/50 transition shadow-inner">
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-400 mb-2 ml-1">¬øQu√© te gustar√≠a que iE
                            supiera sobre ti?</label>
                        <textarea name="user_context" rows="4"
                            placeholder="Ej: Me interesan las ciencias, soy fot√≥grafo, prefiero explicaciones t√©cnicas..."
                            class="w-full bg-black/20 border border-white/5 rounded-2xl px-5 py-4 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500/50 transition shadow-inner">{{ user.user_context or '' }}</textarea>
                        <p class="text-[10px] text-gray-600 mt-2 ml-1">Este contexto ayuda a iE a adaptar mejor sus
                            respuestas a tus necesidades.</p>
                    </div>
                </div>
            </section>

            <!-- Response Style Section -->
            <section class="glass-panel p-8 rounded-[2rem] border border-white/5 space-y-6">
                <h2 class="text-xl font-bold text-white flex items-center gap-3">
                    <span class="text-2xl">üé≠</span> Estilo de Respuesta
                </h2>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <label class="relative cursor-pointer group">
                        <input type="radio" name="response_style" value="default" class="sr-only peer" {{ 'checked' if
                            user.response_style=='default' or not user.response_style }}>
                        <div
                            class="p-5 bg-black/20 border border-white/5 rounded-2xl peer-checked:border-indigo-500 peer-checked:bg-indigo-500/10 transition-all group-hover:bg-white/5">
                            <div class="font-bold text-white mb-1">Por defecto</div>
                            <p class="text-xs text-gray-500 line-clamp-2">Equilibrio profesional, amabilidad y
                                profundidad evolutiva.</p>
                        </div>
                    </label>

                    <label class="relative cursor-pointer group">
                        <input type="radio" name="response_style" value="conciso" class="sr-only peer" {{ 'checked' if
                            user.response_style=='conciso' }}>
                        <div
                            class="p-5 bg-black/20 border border-white/5 rounded-2xl peer-checked:border-cyan-500 peer-checked:bg-cyan-500/10 transition-all group-hover:bg-white/5">
                            <div class="font-bold text-white mb-1">Conciso</div>
                            <p class="text-xs text-gray-500 line-clamp-2">Directo y al grano. Respuestas cortas y
                                eficientes.</p>
                        </div>
                    </label>

                    <label class="relative cursor-pointer group">
                        <input type="radio" name="response_style" value="socratico" class="sr-only peer" {{ 'checked' if
                            user.response_style=='socratico' }}>
                        <div
                            class="p-5 bg-black/20 border border-white/5 rounded-2xl peer-checked:border-purple-500 peer-checked:bg-purple-500/10 transition-all group-hover:bg-white/5">
                            <div class="font-bold text-white mb-1">Socr√°tico</div>
                            <p class="text-xs text-gray-500 line-clamp-2">Gu√≠as con preguntas de sondeo para que t√∫
                                encuentres la respuesta.</p>
                        </div>
                    </label>

                    <label class="relative cursor-pointer group">
                        <input type="radio" name="response_style" value="formal" class="sr-only peer" {{ 'checked' if
                            user.response_style=='formal' }}>
                        <div
                            class="p-5 bg-black/20 border border-white/5 rounded-2xl peer-checked:border-pink-500 peer-checked:bg-pink-500/10 transition-all group-hover:bg-white/5">
                            <div class="font-bold text-white mb-1">Formal</div>
                            <p class="text-xs text-gray-500 line-clamp-2">Tono acad√©mico y experto. Para investigaci√≥n
                                profunda.</p>
                        </div>
                    </label>
                </div>
            </section>

            <!-- Memory Section -->
            <section class="glass-panel p-8 rounded-[2rem] border border-white/5 space-y-6">
                <div class="flex items-center justify-between">
                    <h2 class="text-xl font-bold text-white flex items-center gap-3">
                        <span class="text-2xl">üß†</span> Memoria y Recuerdos
                    </h2>
                    <div class="flex items-center gap-3">
                        <span class="text-xs text-gray-500">Habilitar Memoria</span>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" name="enable_memory" value="true" class="sr-only peer" {{ 'checked'
                                if user.enable_memory }}>
                            <div
                                class="w-11 h-6 bg-white/10 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600">
                            </div>
                        </label>
                    </div>
                </div>

                <div class="bg-black/20 rounded-2xl p-6 border border-white/5">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-sm text-gray-300">Recuerdos Guardados</h3>
                        <button type="button"
                            class="text-xs text-indigo-400 hover:text-white transition">Gestionar</button>
                    </div>

                    <div class="space-y-3">
                        {% if memories %}
                        {% for memory in memories %}
                        <div
                            class="flex items-center justify-between bg-white/5 p-4 rounded-xl border border-white/5 group">
                            <span class="text-sm text-gray-400">{{ memory.fact }}</span>
                            <button type="button" data-memory-id="{{ memory.id }}"
                                class="delete-memory-btn opacity-0 group-hover:opacity-100 text-gray-500 hover:text-red-400 transition">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                </svg>
                            </button>
                        </div>
                        {% endfor %}
                        {% else %}
                        <div class="text-center py-6">
                            <p class="text-xs text-gray-600 italic">No hay recuerdos guardados a√∫n. iE aprender√° de tus
                                charlas.</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </section>

            <div class="flex justify-end gap-4 pt-4">
                <button type="submit"
                    class="px-8 py-4 bg-gradient-to-r from-indigo-600 to-purple-700 text-white font-bold rounded-2xl transition hover:scale-105 active:scale-95 shadow-xl shadow-indigo-900/20">
                    Guardar Configuraci√≥n
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener('click', async (e) => {
        const btn = e.target.closest('.delete-memory-btn');
        if (!btn) return;

        const id = btn.dataset.memoryId;
        if (!confirm('¬øSeguro que quieres borrar este recuerdo?')) return;

        try {
            const resp = await fetch('/settings/memory/delete/' + id, { method: 'POST' });
            if (resp.ok) window.location.reload();
        } catch (err) {
            console.error(err);
        }
    });
</script>
{% endblock %}